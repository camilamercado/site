<!DOCTYPE html>
<html lang="en">
<head>
<title>WORDS BY KYLE</title>
<script src="http://sdks.shopifycdn.com/js-buy-sdk/latest/shopify-buy.polyfilled.globals.min.js"></script>
<script src="credentials.js" type="text/javascript"></script>
<script type="text/javascript">


var shopClient = ShopifyBuy.buildClient({
  apiKey: SapiKey,
  myShopifyDomain:  SmyShopifyDomain,
  appId: SappId
});


shopClient.fetchQueryProducts({collection_id: Scollection_id})
  .then(function(products) {
    var generator = renderProducts(products);
    $('.viewer').html(generator)
});

function renderProducts(products){
  var elems = products.map(function(products){

  	var selects = products.options.map(function (option) {
	  return '<select name="' + option.name + '">' + option.values.map(function(value) {
	    return '<option value="' + value + '">' + value + '</option>';
	  })+ '</select>';
	})

  

 //  var selects = products.options.map(function (option) {
 //  	console.log(option)
 //  	  var options = option.values.map(function(value) {
	//   	var letter = value.slice(0,1);
	//     return '<div value="null" class="option" onClick="selectedS(this)" id="'+value+'">'+letter+'</div>';
	//   })

	//   return '<div class="size">'+options+'</div>';
	// })



    return '<div class="product" key="'+ products.attrs +'" id="'+products.id+'"><img src="'+ products.images[0].src +'"/img><span class="title">' + products.title + '</span><span class="price">$25</span>'+selects+'<div class="quantity">QTY: <input/></div><div class="buyButton" id="'+ products.id +'" onClick="selectedProduct(id, this)" >ADD TO CART</div></div>'; 
})

return elems;

}

</script>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<link href="css/KYLE.css" rel="stylesheet" />


</head>

<body onLoad="init()">
	
	<div class="container">
		
		<div class="nav">
			KYLE
		</div>
		
		<div class="shop">
			<div class="viewer"></div>
		</div>

		<div class="cart">
			
			<div class="cartOpen" onClick="openCart()">
				VIEW CART /
			</div>
			
			<div class="clearCart" onClick="clearCart()"> 
				CLEAR CART
			</div>	
			
			<div class="cartItems"></div>
			
			<div class="checkout">
				CHECKOUT
			</div>
		
		</div>
	
	</div>

	<script type="text/javascript">

	var cart;
	var checkoutURL = null;

	function selectedS(x){
		console.log("i am =", x.value)
		var parentN = x.parentNode;
		var childNs = parentN.childNodes;
	    $(childNs).removeClass("selected");
	    $(x).addClass("selected");
	}

	function init(){
	console.log("initiating cart!")
		shopClient.createCart().then(function (newCart) {
		  cart = newCart;
		  console.log(cart)
		});
	}

    function selectedProduct(id, x){
    console.log("product selected!")
    	var parentN = x.parentNode;
    	var sizeNode = parentN.childNodes[3];
        var size = sizeNode.value;
    	var qtyNode = parentN.childNodes[4];
    	var qty = qtyNode.childNodes[1].value;

    	//console.log("product selected!", size, qty)

    	fetchProduct(id, size, qty);
    }

    function fetchProduct(id, size, qty){
    console.log("fetching product!")
    	shopClient.fetchProduct(id)
		  .then(function (product) {
		  	addtoCart(product, size, qty);
		  })
		  .catch(function () {
		    console.log('Request failed');
		  });
    }


    function addtoCart(product, size, qty){
    console.log("adding to cart!")
	    var option = product.options.map(function (option) {
		  option.selected = size
		  return option;
		});

		var variants = {variant: product.selectedVariant, quantity: qty};
    	cart.addVariants(variants).then(function (cart) {
		  checkoutURL = checkoutURL;
		  var cartier = renderCart(cart);
    	  $('.cartItems').html(cartier)
		});

    }

	function renderCart(cart){
	console.log("rendering cart : ", cart)
		var items = cart.lineItems.map(function(item){
	    return '<div class="item" id="'+item.id+'" onClick="clearItem(id)">'+item.title+' : '+item.quantity+'  '+item.variant_title+'</div>'; 
		})
		return items;
	}

	function openCart(){
	console.log("opening cart!")
		 $(".cartItems").css({"height": "auto"});
		 $(".cartItems").css({"opacity": "1"});
		 $(".cartItems").css({"overflow-y": "show"});
	}

	function clearItem(id){
    console.log("clearing item:", id)
    	cart.removeLineItem(id)
    	 var cartier = renderCart(cart);
    	 $('.cartItems').html(cartier)
    }

    function clearCart(){
    console.log("clearing cart!")
    	cart.clearLineItems()
    	 var cartier = renderCart(cart);
    	 $('.cartItems').html(cartier)
    }
    
	</script>

</body>

</html>












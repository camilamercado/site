<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/green.css">
	<script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>

     <style type="text/css">
    
     img {
     	position: absolute;
     	border: 1px solid magenta;
     	width: 500px;
     	height: 747px;
     	left: 0px;
     	top: 50px;
     }

     .container {
     	position: absolute;
     	border: 1px solid cyan;
     	width: 500px;
     	height: 747px;
     	left: 505px;
     	top: 50px;
     }

     .setColor {
     	position: absolute;
     	width: 100px;
     	height: 20px;
     	margin-left: 50%;
     	left: -50px;
     	border: 1px solid cyan;
     }
     p {
     	position: absolute;
     	width: 100px;
     	height: 20px;
     	margin-left: 50%;
     	left: -160px;
     	top: -5px;
     }
     .enter {
     	position: absolute;
     	width: 20px;
     	height: 20px;
     	margin-left: 50%;
     	left: 60px;
     	color: white;
     	background: tomato;
     	-webkit-border-radius: 5em; -moz-border-radius: 5em;
     }

      </style>

</head>
<body>
		<input class="setColor"></input>
		<p>Enter Hex Val</p>
		<div class="enter" onclick="greenScreen();">GO</div>
		<img id="source" src="http://camilamercado.github.io/site/alba.jpg"  width="500" height="747" />

<script type="text/javascript">

	var img = $("#source").get(0);
	var $canvasbg = $("<div class='container'/>");
	var canvas = $("<canvas class='greenscreen id='target'/>").get(0);
	$canvasbg.append(canvas);
	$('body').append($canvasbg);


	var context = canvas.getContext('2d');
	canvas.width = img.clientWidth;
	canvas.height = img.clientHeight;
	$canvasbg.width(img.clientWidth);
	$canvasbg.height(img.clientHeight);
	context.drawImage(img, 0, 0);

	img.crossOrigin = "Anonymous";
	img.setAttribute('crossOrigin','anonymous');
	img.src = 'http://camilamercado.github.io/site/alba.jpg';

	var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
	var data = imageData.data;
	var start = {
	    red: data[0],
	    green: data[1],
	    blue: data[2]
	};

	// iterate over all pixels
	var tolerance = 120;
	for(var i = 0, n = data.length; i < n; i += 4) {
	    var diff = Math.abs(data[i] - data[0]) + Math.abs(data[i+1] - data[1]) + Math.abs(data[i+2] - data[2]);
	    if(diff < tolerance) {
	        data[i + 3] = 0;
	    }
	}

	function greenScreen(){

		var setColor = document.querySelector(".setColor").value;
		console.log(setColor);
		context.putImageData(imageData, 0, 0);
		$canvasbg.css('background', setColor);

	};

	// var invocation = new XMLHttpRequest();
	// var url = 'http://localhost/~camila/img/alba.jpg';
	
	// function callOtherDomain(){
 //  	if(invocation) {
 //    invocation.open('GET', url, true);
 //    invocation.withCredentials = true;
 //    invocation.onreadystatechange = handler;
 //    invocation.send();
 //    console.log("fuck you") 
 //  	}};

  	// https://dl.dropboxusercontent.com/u/79492332/alba.jpg

</script>



</body>
</html>
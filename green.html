<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="css/green.css">
	<script src="http://code.jquery.com/jquery-latest.min.js"
        type="text/javascript"></script>

</head>
<body>
		
		<img id="source" src="alba.jpg"/>

<script type="text/javascript">

	var img = $("#source").get(0);
	var $canvasbg = $("<div class='container'/>");
	var canvas = $("<canvas class='greenscreen id='target'/>").get(0);
	$canvasbg.append(canvas);
	$('body').append($canvasbg);


	var context = canvas.getContext('2d');
	canvas.width = img.clientWidth;
	canvas.height = img.clientHeight;
	$canvasbg.width(img.clientWidth);
	$canvasbg.height(img.clientHeight);
	context.drawImage(img, 0, 0);

	img.crossOrigin = "Anonymous";
	img.src = 'http://localhost/~camila/img/alba.jpg';

	var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
	var data = imageData.data;
	var start = {
	    red: data[0],
	    green: data[1],
	    blue: data[2]
	};

	// iterate over all pixels
	var tolerance = 150;
	for(var i = 0, n = data.length; i < n; i += 4) {
	    var diff = Math.abs(data[i] - data[0]) + Math.abs(data[i+1] - data[1]) + Math.abs(data[i+2] - data[2]);
	    if(diff < tolerance) {
	        data[i + 3] = 0;
	    }
	}
	context.putImageData(imageData, 0, 0);
	$canvasbg.css('background','red');


	var invocation = new XMLHttpRequest();
	var url = 'http://localhost/~camila/img/alba.jpg';
	
	function callOtherDomain(){
  	if(invocation) {
    invocation.open('GET', url, true);
    invocation.withCredentials = true;
    invocation.onreadystatechange = handler;
    invocation.send(); 
  	}};

</script>



</body>
</html>
<!DOCTYPE html>
<html lang="en">
    
    <head>
        <meta charset="utf-8">
        <title>Green Screen</title>
        <style>
            #hCanvas {
                display: none
            }
            #dCanvas {
                background: url('alba.png') no-repeat 0 0 / cover;
                width: 500px;
                height: 800px;
            }
        </style>
    </head>
    
    <body>
        <video id="sourceVid" controls="true">
            <source src="AAA.webm" />
        </video>
        <canvas id="hCanvas"></canvas>
        <canvas id="dCanvas"></canvas>
        
        <script type="text/javascript">
            var doc = document;
            var sourceVid = doc.getElementById("sourceVid");
            var hCanvas = doc.getElementById("hCanvas");
            var dCanvas = doc.getElementById("dCanvas");
            var hContext = hCanvas.getContext("2d");
            var dContext = dCanvas.getContext("2d");
            
                        sourceVid.addEventListener('loadeddata', function() {
                            hCanvas.setAttribute('width', sourceVid.offsetWidth);
                            dCanvas.setAttribute('width', sourceVid.offsetWidth);
                            hCanvas.setAttribute('height', sourceVid.offsetHeight);
                            dCanvas.setAttribute('height', sourceVid.offsetHeight);
                        }, false);
                        
            sourceVid.addEventListener('play', function() {
                runAnalysis();
            });

            var runAnalysis = function() {
                if (sourceVid.paused || sourceVid.ended) {
                    return
                }
                frameFix();
                if (window.requestAnimationFrame) {
                    requestAnimationFrame(runAnalysis);
                } else {
                    setTimeout(runAnalysis, 0);
                }
            };

var frameFix = function() 
{
  hContext.drawImage(sourceVid, 0, 0, sourceVid.videoWidth, sourceVid.videoHeight);

  var frame  = hContext.getImageData(0, 0, sourceVid.videoWidth, sourceVid.videoHeight),
      data   = frame.data,
      length = data.length, i;

  for (i = 0; i < length; i += 4) 
    if (data[i] < 100 && data[i + 1] < 100 && data[i + 2] < 100) 
      data[i + 3] = 0;

  dContext.putImageData(frame, 0, 0);
};

        </script>
    </body>

</html>